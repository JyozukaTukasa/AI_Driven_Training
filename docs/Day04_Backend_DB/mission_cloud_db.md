# Mission: æ¶ˆãˆãªã„ãƒãƒ£ãƒƒãƒˆã‚¢ãƒ—ãƒª (Global Chat)

Day 4 ã® Boss Battle ã§ã™ã€‚
Drillã§å­¦ã‚“ã ã€Œä¿å­˜ã€ã¨ã€Œèª­ã¿è¾¼ã¿ã€ã‚’çµ„ã¿åˆã‚ã›ã¦ã€**ã€Œãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦ã‚‚æ¶ˆãˆãªã„ãƒãƒ£ãƒƒãƒˆã€** ã‚’ä½œã‚Šã¾ã™ã€‚
ä¸–ç•Œä¸­ã®èª°ã‚‚ãŒæ›¸ãè¾¼ã‚ã‚‹ã€æœ¬ç‰©ã®Webã‚¢ãƒ—ãƒªã§ã™ã€‚

## ğŸ¯ Goal
1.  **æŠ•ç¨¿**: åå‰ã¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥ã‚Œã¦é€ä¿¡ã§ãã‚‹ã€‚
2.  **ä¸€è¦§**: ã¿ã‚“ãªã®æŠ•ç¨¿ãŒå¤ã„é †ï¼ˆã¾ãŸã¯æ–°ã—ã„é †ï¼‰ã«ä¸¦ã‚“ã§ã„ã‚‹ã€‚
3.  **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ **: èª°ã‹ãŒæŠ•ç¨¿ã—ãŸã‚‰ã€ãƒªãƒ­ãƒ¼ãƒ‰ã—ãªãã¦ã‚‚å‹æ‰‹ã«è¡¨ç¤ºãŒå¢—ãˆã‚‹ï¼ˆå¿œç”¨ï¼‰ã€‚

---

## Step 1: Block Sketch
-   **å…¥åŠ›ã‚¨ãƒªã‚¢**
    -   åå‰ (`input`)
    -   ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ (`input`)
    -   é€ä¿¡ãƒœã‚¿ãƒ³
-   **ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³**
    -   æŠ•ç¨¿ã‚«ãƒ¼ãƒ‰ã®ãƒªã‚¹ãƒˆ (`ul` or `div`)

## Step 2: Translation
-   **ã€Œãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–ã€** â†’ `onSnapshot` (è¾æ›¸å¤–ã®å¿œç”¨ãƒ¯ãƒ¼ãƒ‰)
    -   â€» AIã«ã€Œãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§æ›´æ–°ã—ã¦ã€ã¨è¨€ãˆã°å‡ºã¦ãã¾ã™ã€‚

---

## Step 3: Construct

### ğŸ¤– Prompt Example
```text
ã€ä½œã‚ŠãŸã„ã‚‚ã®ã€‘
Firebaseã‚’ä½¿ã£ãŸãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒãƒ£ãƒƒãƒˆã‚¢ãƒ—ãƒªã€‚

ã€æ§‹é€ ã€‘
1. å…¥åŠ›ã‚¨ãƒªã‚¢
   - "Name", "Message" ã®å…¥åŠ›æ¬„ã€‚
   - "Send" ãƒœã‚¿ãƒ³ã€‚
2. ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³
   - æŠ•ç¨¿ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‚¨ãƒªã‚¢ã€‚

ã€å‹•ãã€‘
1. Sendãƒœã‚¿ãƒ³ã§ã€Firestoreã® `posts` ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã« `{ name, message, timestamp }` ã‚’ä¿å­˜ã€‚
2. **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦– (`onSnapshot`)** ã‚’ä½¿ã£ã¦ã€
   `posts` ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã«å¤‰åŒ–ãŒã‚ã£ãŸã‚‰ã€è‡ªå‹•çš„ã«ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã‚’æ›´æ–°ã—ã¦ãã ã•ã„ã€‚
   - æ–°ã—ã„æŠ•ç¨¿ãŒä¸Šã«æ¥ã‚‹ã‚ˆã†ã«ä¸¦ã³æ›¿ãˆã¦ãã ã•ã„ã€‚
```

---

## Step 4: Code Literacy (è§£å‰–)
1.  **ã€Œä¸¦ã³æ›¿ãˆã€ã®é­”æ³•**
    -   `orderBy("timestamp", "desc")` ã¨ã„ã†è¨˜è¿°ã‚’æ¢ã—ã¦ãã ã•ã„ã€‚
    -   `desc` (é™é †) ã‚’ `asc` (æ˜‡é †) ã«å¤‰ãˆã‚‹ã¨ã€ä¸¦ã³é †ã¯ã©ã†ãªã‚Šã¾ã™ã‹ï¼Ÿ
2.  **ã€Œç›£è¦–ã€ã®é­”æ³•**
    -   `onSnapshot` ã¯ã€Œå¤‰åŒ–ãŒã‚ã£ãŸæ™‚ã ã‘å‹•ãã€ç‰¹åˆ¥ãªå‘½ä»¤ã§ã™ã€‚
    -   ã“ã‚Œã®ãŠã‹ã’ã§ã€ãƒªãƒ­ãƒ¼ãƒ‰åœ°ç„ã‹ã‚‰è§£æ”¾ã•ã‚Œã¾ã™ã€‚

**Challenge**: 
è‡ªåˆ†ã®ã‚¹ãƒãƒ›ã§ã“ã®ãƒšãƒ¼ã‚¸ã‚’é–‹ã„ã¦æ›¸ãè¾¼ã‚“ã§ã¿ã¦ãã ã•ã„ï¼ˆãƒ‡ãƒ—ãƒ­ã‚¤å¾Œï¼‰ã€‚
PCã®ç”»é¢ã«ã‚‚å‹æ‰‹ã«æ–‡å­—ãŒå‡ºã¦ãã¾ã—ãŸã‹ï¼Ÿ ãã‚ŒãŒã€Œã‚¯ãƒ©ã‚¦ãƒ‰ã€ã§ã™ã€‚

---

## Step 5: Hardening (å …ç‰¢åŒ–)
ä»Šã®ã¾ã¾ã ã¨ã€**ä¸–ç•Œä¸­ã®èª°ã§ã‚‚ãƒ‡ãƒ¼ã‚¿ã‚’å…¨æ¶ˆã—ã§ãã¾ã™ã€‚**
ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ `deleteDoc(...)` ã¨æ‰“ãŸã‚ŒãŸã‚‰çµ‚ã‚ã‚Šã§ã™ã€‚
ã“ã‚Œã‚’é˜²ãã€Œãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«ï¼‰ã€ã‚’è¨­å®šã—ã¾ã™ã€‚

### ğŸ›¡ï¸ Defense 1: èª­ã¿æ›¸ãã®åˆ¶é™
Firebaseã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã® "Rules" ã‚¿ãƒ–ã‚’é–‹ãã€ä»¥ä¸‹ã®ãƒ«ãƒ¼ãƒ«ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚

```text
allow read: if true; (èª°ã§ã‚‚èª­ã‚ã‚‹)
allow create: if request.resource.data.name != ""; (åå‰ãŒã‚ã‚Œã°æ›¸ã‘ã‚‹)
allow delete: if false; (å‰Šé™¤ã¯çµ¶å¯¾ç¦æ­¢ï¼)
```

### âš”ï¸ Attack Simulation (æ”»æ’ƒå®Ÿé¨“)
ãƒ«ãƒ¼ãƒ«ã‚’è¨­å®šã—ãŸã‚‰ã€è‡ªåˆ†ã®ã‚¢ãƒ—ãƒªã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’ã€Œå‰Šé™¤ã€ã—ã‚ˆã†ã¨ã—ã¦ã¿ã¦ãã ã•ã„ã€‚
ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã« **"Missing or insufficient permissions"** ã¨ã„ã†èµ¤æ–‡å­—ã®ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚Œã°ã€é˜²å¾¡æˆåŠŸã§ã™ã€‚

> **Lesson**: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¯ã€Œç¥ˆã‚Šã€ã§ã¯ãªãã€Œè¨­å®šã€ã§ã™ã€‚
> æ”»æ’ƒã‚’é˜²ã’ãŸã“ã¨ã‚’ç¢ºèªï¼ˆãƒ†ã‚¹ãƒˆï¼‰ã—ã¦å®Œäº†ã¨ãªã‚Šã¾ã™ã€‚

---
**[Next]** ğŸ‘‰ [Day 5: çµ±åˆé–‹ç™º (The Dungeon)](../Day05_Integrated/05_concept_design.md)
